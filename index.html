<html><head><meta charset="utf-8"></head><body><script type="text/javascript">
(( exports ) => {

	'use strict';

	class SentenceSayer {

		static sentenceToString( sentence ) {

			var string = "";
			for (var i = 0; i < sentence.length; i++) {
				string += sentence[ i ];

				if (i == sentence.length - 2) string += " ja ";
				else if (i < sentence.length - 2 ) string += ", ";
			}

			if (sentence.prefix) string = sentence.prefix + " " + string;

			if (string.length > 0) string = string[0].toUpperCase() + string.substr( 1 );

			return string;
		}
	}

	class SentenceSayerConsoleLog extends SentenceSayer {

		async say( sentence ) {

			console.log( SentenceSayer.sentenceToString( sentence ));
		}
	}

	class SentenceSayerHTMLInjector extends SentenceSayer {

		constructor( element = document.createElement( "div" ) ) {

			super();

			this.element = element;
		}

		async say( sentence ) {

			var string = SentenceSayer.sentenceToString( sentence );

			this.element.innerHTML = "<span>" + string + "</span>";

		}
	}

	class SentenceSayerSpeechApi extends SentenceSayer {

		rate = 1;

		pitch = 1;

		volume = 1;

		constructor() {

			super();

			var self = this;

			var speech = this.speech = window.speechSynthesis;
			

			populateVoiceList();

			if (speech.onvoiceschanged !== undefined) {
				speech.onvoiceschanged = () => populateVoiceList();
			}

			function populateVoiceList() {

				var voices = self.voices = speech.getVoices(); // now should have an array of all voices

				if (voices.length > 0) {

					if (self.voice) {

						var found;

						for (var voice of voices) {
							if (self.voice.name == voice.name) {
								found = voice;
								break;
							}
						}

						self.voice = found || null;
					}

					if (!self.voice) {
						for (var voice of voices) {
							if (voice.lang == "fi-FI") {
								self.voice = voice;
								break;
							}
						}
					}

					if (!self.voice) {
						for (var voice of voices) {
							if (voice.default && voice.lang == "en-GB") {
								self.voice = voice;
								break;
							}
						}
					}

					if (!self.voice) {
						for (var voice of voices) {
							if (voice.lang == "en-GB") {
								self.voice = voice;
								break;
							}
						}
					}

					if (!self.voice) self.voice = voices[0];
				}
			}
		}

		async say( sentence ) {

			var string = SentenceSayer.sentenceToString( sentence );
		
			var utterance = new SpeechSynthesisUtterance( string );

			utterance.rate  = this.rate;
			utterance.pitch = this.pitch;
			utterance.volume = this.volume;
		
			if (this.voice) utterance.voice = this.voice;

			this.speech.speak( utterance );

		}
	}

	SentenceSayer.SpeechApi    = SentenceSayerSpeechApi;
	SentenceSayer.ConsoleLog   = SentenceSayerConsoleLog;
	SentenceSayer.HTMLInjector = SentenceSayerHTMLInjector;

	exports.SentenceSayer = SentenceSayer;

})( this );
(( exports ) => {

	'use strict';

	class Valmentaja {

		running = false;

		timeout_ms = 1000;

		constructor( sentenceGenerator ) {

			this.sentenceGenerator = sentenceGenerator;
		}

		start() {

			if (!this.sentenceGenerator) return;

			this.running = true;

			this.loop();
		}

		stop() {

			this.running = false;
		}

		async loop() {

			if (!this.running) return;

			try {

				await this.run();

				setTimeout(() => this.loop(), this.timeout_ms );

			} catch (error) {

				console.error( error );

				this.stop();
			}
		}

		async run() {

			var sentence = this.sentenceGenerator();

			if (!sentence || sentence.length == 0) return;

			await this.say( sentence );
		}

		async say( sentence ) {

			console.debug( SentenceSayer.sentenceToString( sentence ));

			if (this.sentenceSayer) {

				this.sentenceSayer.say( sentence );

			} else {

				console.error( new Error( "No sentenceSayer setted!" ));
			}
		}

		setSayer( sentenceSayer ) {

			this.sentenceSayer = sentenceSayer;
		}


		setSpeed( timeout_ms ) {

			this.timeout_ms = timeout_ms;
		}
	}

	exports.Valmentaja = Valmentaja;

})( this );
(() => {

	var buildSentence = (() => {

		const hits_singles = [ "suora", "koukku", "uppari", "kyynärpää yltä", "kyynärpää alta", "polvi", "kiertopotku" ];

		const hits_sides = hits_singles.reduce(( sides, hit ) => {

			return sides.push( "vasen " + hit ), sides.push( "oikea " +  hit ), sides;

		}, []);

		const hits_sameside = hits_singles.map( v => v );

		const word_sets = [ hits_singles, hits_sides, hits_sameside ];


		return (max_length = 1, min_length = 1, sentence = []) => {
		
			var set = word_sets[ parseInt( Math.random() * word_sets.length ) ];

			if (!(min_length >= 0)) return;
			if (!(min_length <= max_length)) return;

			var count = max_length - min_length + 1;

			count = Math.floor( count * Math.random() );

			var words = word_sets[ parseInt( word_sets.length * Math.random()) ];

			for (var i = 0; i < count; i++) {

				var idx = parseInt( Math.random() * words.length );
				
				sentence.push( words[idx] );
			}

			if (set == hits_sameside) {
				if (sentence.length > 1) sentence.prefix = "Saman puolen";
			}
			
			return sentence;
		}
	})();

	/******************/

	const valmentaja = new Valmentaja(() => buildSentence( 2, 0 ));

	setTimeout( onload, 100 );

	function onload() {

		var sayer;

		//sayer = new SentenceSayer.HTMLInjector( document.getElementById( "content" ) );
		sayer = new SentenceSayer.SpeechApi();
		//sayer = new SentenceSayer.ConsoleLog();

		valmentaja.setSayer( sayer );

		valmentaja.setSpeed( 2500 ); // 2.5s

		valmentaja.start();
	}
})();

</script></body></html>
